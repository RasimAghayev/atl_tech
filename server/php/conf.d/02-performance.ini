; ===================================================
; PHP Performance Configuration
; server/php/conf.d/02-performance.ini
; ===================================================

; === OPCACHE CONFIGURATION ===
opcache.enable = 1
opcache.enable_cli = 1
opcache.memory_consumption = 256
opcache.interned_strings_buffer = 16
opcache.max_accelerated_files = 10000
opcache.max_wasted_percentage = 5

; === PRODUCTION OPCACHE (Enable in production) ===
; opcache.validate_timestamps = 0
; opcache.revalidate_freq = 0

; === DEVELOPMENT OPCACHE (Enable in development) ===
opcache.validate_timestamps = 1
opcache.revalidate_freq = 2

; === ADVANCED OPCACHE ===
opcache.fast_shutdown = 1
opcache.enable_file_override = 1
opcache.optimization_level = 0x7FFFBFFF
opcache.dups_fix = Off
opcache.blacklist_filename = ""
opcache.max_file_size = 0
opcache.consistency_checks = 0
opcache.force_restart_timeout = 180
opcache.error_log = /var/log/php/opcache.log
opcache.log_verbosity_level = 1

; === JIT CONFIGURATION (PHP 8.0+) ===
opcache.jit = 1255
opcache.jit_buffer_size = 128M
opcache.jit_debug = 0

; === REALPATH CACHE ===
realpath_cache_size = 4096K
realpath_cache_ttl = 600

; === MEMORY OPTIMIZATION ===
memory_limit = 512M
max_execution_time = 120
max_input_time = 120

; === REQUEST LIMITS ===
max_input_vars = 5000
max_input_nesting_level = 128
post_max_size = 64M
upload_max_filesize = 32M

; === OUTPUT OPTIMIZATION ===
output_buffering = 4096
implicit_flush = Off
zlib.output_compression = On
zlib.output_compression_level = 6

; === SESSION PERFORMANCE ===
session.gc_probability = 1
session.gc_divisor = 10000
session.gc_maxlifetime = 1440
session.cache_limiter = nocache
session.cache_expire = 180

; === GARBAGE COLLECTION ===
zend.enable_gc = On

; === FILE OPERATIONS ===
auto_detect_line_endings = Off

; === REGEX OPTIMIZATION ===
pcre.backtrack_limit = 1000000
pcre.recursion_limit = 100000
pcre.jit = 1

; === ASSERT PERFORMANCE ===
assert.active = Off
assert.warning = Off
assert.bail = Off

; === VARIABLE ORDER ===
variables_order = "GPCS"
request_order = "GP"

; === SERIALIZATION ===
serialize_precision = -1

; === MISCELLANEOUS PERFORMANCE ===
default_socket_timeout = 60
;max_input_time = 60
ignore_user_abort = Off

; === URL REWRITER ===
url_rewriter.tags = ""
url_rewriter.hosts = ""

; === FILTER ===
filter.default = unsafe_raw
filter.default_flags = ""